<!-- templates/recetas/crear.html -->
<div class="container-fluid">
  <div class="card shadow">
    <div class="card-body">
      <form th:action="@{/recetas/guardar}" method="post" th:object="${recetaRequest}">
        
        <!-- Nombre y Descripción -->
        <div class="row mb-4">
          <div class="col-md-6">
            <label class="form-label fw-bold">Nombre *</label>
            <input type="text" class="form-control" th:field="*{nombre}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-bold">Descripción</label>
            <input type="text" class="form-control" th:field="*{descripcion}">
          </div>
        </div>
        
        <!-- INGREDIENTES FIJOS (3 filas siempre visibles) -->
        <div class="card mb-4">
          <div class="card-header bg-light">
            <h6 class="mb-0">Ingredientes *</h6>
          </div>
          <div class="card-body">
            <!-- Fila 1 (siempre visible, requerida) -->
            <div class="row g-2 mb-2">
              <div class="col-md-6">
                <select class="form-select" name="ingredientes[0].ingredienteId" required>
                  <option value="">Seleccionar ingrediente...</option>
                  <option th:each="ing : ${ingredientes}" 
                          th:value="${ing.id}"
                          th:text="${ing.nombreIngrediente}"></option>
                </select>
              </div>
              <div class="col-md-4">
                <input type="number" step="0.01" min="0.01" class="form-control"
                       name="ingredientes[0].cantidadNecesaria" required
                       placeholder="Cantidad">
              </div>
              <div class="col-md-2">
                <!-- Vacío para la primera fila -->
              </div>
            </div>
            
            <!-- Fila 2 (opcional) -->
            <div class="row g-2 mb-2">
              <div class="col-md-6">
                <select class="form-select" name="ingredientes[1].ingredienteId">
                  <option value="">Seleccionar ingrediente...</option>
                  <option th:each="ing : ${ingredientes}" 
                          th:value="${ing.id}"
                          th:text="${ing.nombreIngrediente}"></option>
                </select>
              </div>
              <div class="col-md-4">
                <input type="number" step="0.01" min="0.01" class="form-control"
                       name="ingredientes[1].cantidadNecesaria"
                       placeholder="Cantidad">
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger w-100" 
                        onclick="ocultarFila(1)">✕</button>
              </div>
            </div>
            
            <!-- Fila 3 (opcional) -->
            <div class="row g-2 mb-2">
              <div class="col-md-6">
                <select class="form-select" name="ingredientes[2].ingredienteId">
                  <option value="">Seleccionar ingrediente...</option>
                  <option th:each="ing : ${ingredientes}" 
                          th:value="${ing.id}"
                          th:text="${ing.nombreIngrediente}"></option>
                </select>
              </div>
              <div class="col-md-4">
                <input type="number" step="0.01" min="0.01" class="form-control"
                       name="ingredientes[2].cantidadNecesaria"
                       placeholder="Cantidad">
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger w-100" 
                        onclick="ocultarFila(2)">✕</button>
              </div>
            </div>
            
            <!-- Mensaje -->
            <small class="text-muted">La primera fila es obligatoria. Puedes agregar hasta 3 ingredientes.</small>
          </div>
        </div>
        
        <!-- Botones -->
        <div class="d-flex justify-content-between pt-3 border-top">
          <a th:href="@{/recetas}" class="btn btn-outline-secondary">Cancelar</a>
          <button type="submit" class="btn btn-primary">Guardar Receta</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function ocultarFila(index) {
    const fila = document.querySelector(`[name="ingredientes[${index}].ingredienteId"]`).closest('.row');
    if (fila) {
      // Limpiar valores
      fila.querySelector('select').value = '';
      fila.querySelector('input').value = '';
      // Ocultar
      fila.style.display = 'none';
    }
  }
</script>